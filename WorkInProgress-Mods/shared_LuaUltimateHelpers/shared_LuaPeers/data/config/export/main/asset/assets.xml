<ModOps>

  <!-- Serp GUID 1500005537 bis einschlieÃŸlich 1500005545 -->
  <!-- 1500005537 und 1500005545 noch frei -->
  
  
  <!-- Change the PlayerDisconnected/PlayerLeft PopUps to only offer "Leave Game" as Option. -->
   <!-- Because its a by far too big hassle to update the lua information and check who the hell left the game. -->
    <!-- So instead they all leave and load the game with the new amount of players and lua is inited new -->
   <!-- its fine that this ModOp hits every <Item> (every Button) -->
  <ModOp Type="merge" GUID='500115' Path="/Values/GenericPopup/Popups/*[self::PlayerDisconnected or self::PlayerLeft]/Buttons/Item">
    <Text>16111</Text>
  </ModOp>
  <ModOp Type="merge" GUID='500115' Path="/Values/GenericPopup/Popups/*[self::PlayerDisconnected or self::PlayerLeft]/Buttons/Item">
    <Command>GameManager.OnlineManager.leaveSession()</Command>
  </ModOp>
  
  

  
  
  <!-- ###  -->
  <!-- empty dummy session -->
  <!-- to identify inactive human players (playerslots that were filled at some time of the game, but currently loaded without them) -->
  <!-- I found no other way to get this information and it is crucial to know for lua scripts that should work in multiplayer -->
  
  <ModOp Type="addNextSibling" GUID='141381'>
    <Asset>
      <Template>MapTemplate</Template>
      <Values>
        <Standard>
          <GUID>1500005539</GUID>
          <Name>SmallEmptyMapTemplate</Name>
        </Standard>
        <MapTemplate>
          <IslandSize>Small</IslandSize>
          <AddDecorationIslands>0</AddDecorationIslands>
          <TemplateFilename>data/dummysession/moderate_archipel_ll.a7t</TemplateFilename>>
          <FixedPreplacedParticipants>
            <Item />
          </FixedPreplacedParticipants>
          <TemplateSize>Small</TemplateSize>
          <TemplateSubRegion>SecondaryRegion</TemplateSubRegion>
          <Campaign>0</Campaign>
          <IsUsedByMapGenerator>0</IsUsedByMapGenerator>
          <TemplateRegion>Moderate</TemplateRegion>
          <TemplateMapType>Archipelago</TemplateMapType>
        </MapTemplate>
      </Values>
    </Asset>
  </ModOp>
  
  <ModOp Type="addNextSibling" GUID='180014'>
    <Asset>
      <Template>SessionModerate</Template>
      <Values>
        <Standard>
          <GUID>1500005538</GUID>
          <Name>SmallEmptySession</Name>
        </Standard>
        <Session>
          <Region>5000000</Region>
          <MapTemplate>1500005539</MapTemplate>
          <SpawnStartShipAndKontor>0</SpawnStartShipAndKontor>
          <ShipTransferEnabled>0</ShipTransferEnabled>
          <InMenuVisible>0</InMenuVisible>
          <SecondPartiesMaySettleHere>0</SecondPartiesMaySettleHere>
        </Session>
        <Locked>
          <DefaultLockedState>1</DefaultLockedState>
        </Locked>
        <WorldMapSound />
      </Values>
    </Asset>
  </ModOp>

  <ModOp Type="add" GUID='140560' Path="/Values/PlayerCounterConfig/CounterConfig/FunFactsCounter/Item/FilterResults/IgnoreScopeContexts">
    <Item>
      <Asset>1500005538</Asset>
    </Item>
  </ModOp>
  
  <ModOp GUID="153271" Type="AddNextSibling">
    <!-- In this case we can use a normal trigger isntead of FeatureUnlock, because we want every player to enter the session at the same time anyways, so not a problem that it gets registered multiple times for coop if registered via lua -->
    <Asset>
      <Template>Trigger</Template>
      <Values>
        <Standard>
          <GUID>1500005540</GUID>
          <Name>Enter Empty Session</Name>
        </Standard>
        <Trigger>
          <TriggerCondition>
            <Template>ConditionAlwaysTrue</Template>
            <Values>
              <ConditionAlwaysTrue />
              <Condition />
            </Values>
          </TriggerCondition>
          <TriggerActions>
            <Item>
              <TriggerAction>
                <Template>ActionEnterSession</Template>
                <Values>
                  <ActionEnterSession>
                    <TargetSession>1500005538</TargetSession>
                  </ActionEnterSession>
                  <Action />
                </Values>
              </TriggerAction>
            </Item>
          </TriggerActions>
        </Trigger>
        <TriggerSetup>
          <AutoRegisterTrigger>0</AutoRegisterTrigger>
          <UsedBySecondParties>0</UsedBySecondParties>
        </TriggerSetup>
      </Values>
    </Asset>
    
    <Asset>
      <Template>FeatureUnlock</Template>
      <Values>
        <Standard>
          <GUID>1500005541</GUID>
          <Name>Load Empty Session (unloading in lua or make another trigger)</Name>
        </Standard>
        <Locked />
        <Trigger>
          <TriggerCondition>
            <Template>ConditionUnlocked</Template>
            <Values>
              <Condition />
              <ConditionUnlocked>
                <UnlockNeeded>1500005541</UnlockNeeded>
              </ConditionUnlocked>
              <ConditionPropsNegatable />
            </Values>
          </TriggerCondition>
          <TriggerActions>
            <Item>
              <TriggerAction>
                <Template>ActionUnlockAsset</Template>
                <Values>
                  <Action />
                  <ActionUnlockAsset>
                    <UnlockAssets>
                      <Item>
                        <Asset>1500005538</Asset>
                      </Item>
                    </UnlockAssets>
                    <UnhideAssets />
                  </ActionUnlockAsset>
                </Values>
              </TriggerAction>
            </Item>
            <Item>
              <TriggerAction>
                <Template>ActionLoadSession</Template>
                <Values>
                  <Action />
                  <ActionLoadSession>
                    <LoadSession>1500005538</LoadSession>
                  </ActionLoadSession>
                </Values>
              </TriggerAction>
            </Item>
            <Item>
              <TriggerAction>
                <Template>ActionDelayedActions</Template>
                <Values>
                  <Action />
                  <ActionDelayedActions>
                    <ExecutionDelay>500</ExecutionDelay>
                    <DelayedActions>
                      <IsBaseAutoCreateAsset>1</IsBaseAutoCreateAsset>
                      <Values>
                        <ActionList>
                          <Actions>
                            <Item>
                              <Action>
                                <Template>ActionLockAsset</Template>
                                <Values>
                                  <Action />
                                  <ActionLockAsset>
                                    <LockAssets>
                                      <Item>
                                        <Asset>1500005541</Asset>
                                      </Item>
                                    </LockAssets>
                                  </ActionLockAsset>
                                </Values>
                              </Action>
                            </Item>
                          </Actions>
                        </ActionList>
                      </Values>
                    </DelayedActions>
                  </ActionDelayedActions>
                </Values>
              </TriggerAction>
            </Item>
          </TriggerActions>
          <!-- use a small timer to reset, because because of coroutine.yield the lua local coop players could be in a different gametick which could lead to multiple unlocks within short time -->
          <ResetTrigger>
            <Template>AutoCreateTrigger</Template>
            <Values>
              <Trigger>
                <TriggerCondition>
                  <Template>ConditionTimer</Template>
                  <Values>
                    <Condition />
                    <ConditionTimer>
                      <TimeLimit>1000</TimeLimit>
                    </ConditionTimer>
                  </Values>
                </TriggerCondition>
              </Trigger>
            </Values>
          </ResetTrigger>
        </Trigger>
        <TriggerSetup>
          <AutoRegisterTrigger>1</AutoRegisterTrigger>
          <UsedBySecondParties>0</UsedBySecondParties>
          <AutoSelfUnlock>0</AutoSelfUnlock>
        </TriggerSetup>
      </Values>
    </Asset>
    
    <Asset>
      <Template>Trigger</Template>
      <Values>
        <Standard>
          <GUID>1500005542</GUID>
          <Name>Show Lua Done Notification (Unique and we want to to show for everyone, so fine as a Trigger)</Name>
        </Standard>
        <Trigger>
          <TriggerCondition>
            <Template>ConditionAlwaysTrue</Template>
            <Values>
              <ConditionAlwaysTrue />
              <Condition />
            </Values>
          </TriggerCondition>
          <TriggerActions>
            <Item>
              <TriggerAction>
                <Template>ActionNotification</Template>
                <Values>
                  <Action />
                  <ActionNotification>
                    <Notification>
                      <Template>AudioNotification</Template>
                      <Values>
                        <BaseNotification>
                          <NotificationBlockingTime>0</NotificationBlockingTime>
                          <NotificationPriority>-1</NotificationPriority>
                          <NotificationMinDisplayTime>10000</NotificationMinDisplayTime>
                          <DisplayTimeout>60000</DisplayTimeout>
                          <IsUnique>1</IsUnique>
                        </BaseNotification>
                        <AudioNotification>
                          <AudioNotificationPortrait>77</AudioNotificationPortrait>
                        </AudioNotification>
                        <NotificationSubtitle>
                          <Subtitle>1500005542</Subtitle>
                        </NotificationSubtitle>
                      </Values>
                    </Notification>
                  </ActionNotification>
                </Values>
              </TriggerAction>
            </Item>
          </TriggerActions>
        </Trigger>
        <TriggerSetup>
          <AutoRegisterTrigger>0</AutoRegisterTrigger>
          <UsedBySecondParties>0</UsedBySecondParties>
        </TriggerSetup>
        <AudioText>
          <AudioAsset>234153</AudioAsset>
          <SpeechAudioPriority>999</SpeechAudioPriority>
        </AudioText>
      </Values>
    </Asset>
    <Asset>
      <Template>Trigger</Template>
      <Values>
        <Standard>
          <GUID>1500005543</GUID>
          <Name>Show Lua Warning Notification (Unique and we want to to show for everyone, so fine as a Trigger)</Name>
        </Standard>
        <Trigger>
          <TriggerCondition>
            <Template>ConditionAlwaysTrue</Template>
            <Values>
              <ConditionAlwaysTrue />
              <Condition />
            </Values>
          </TriggerCondition>
          <TriggerActions>
            <Item>
              <TriggerAction>
                <Template>ActionNotification</Template>
                <Values>
                  <Action />
                  <ActionNotification>
                    <Notification>
                      <Template>AudioNotification</Template>
                      <Values>
                        <BaseNotification>
                          <NotificationBlockingTime>0</NotificationBlockingTime>
                          <NotificationPriority>-1</NotificationPriority>
                          <NotificationMinDisplayTime>10000</NotificationMinDisplayTime>
                          <DisplayTimeout>60000</DisplayTimeout>
                          <IsUnique>1</IsUnique>
                        </BaseNotification>
                        <AudioNotification>
                          <AudioNotificationPortrait>77</AudioNotificationPortrait>
                        </AudioNotification>
                        <NotificationSubtitle>
                          <Subtitle>1500005543</Subtitle>
                        </NotificationSubtitle>
                      </Values>
                    </Notification>
                  </ActionNotification>
                </Values>
              </TriggerAction>
            </Item>
          </TriggerActions>
        </Trigger>
        <TriggerSetup>
          <AutoRegisterTrigger>0</AutoRegisterTrigger>
          <UsedBySecondParties>0</UsedBySecondParties>
        </TriggerSetup>
        <AudioText>
          <AudioAsset>234169</AudioAsset>
          <SpeechAudioPriority>999</SpeechAudioPriority>
        </AudioText>
      </Values>
    </Asset>
    
    <!-- 1500005544 will be unlocked via lua and stay unlocked as long as the helper session is loaded. -->
     <!-- As soon as all peers have an alternative session (checked on IslandSettled) we will lock this and unload the session -->
    <Asset>
      <Template>FeatureUnlock</Template>
      <Values>
        <Standard>
          <GUID>1500005544</GUID>
          <Name>Unload Helper Session IslandSettled</Name>
        </Standard>
        <Locked />
        <Trigger>
          <TriggerCondition>
            <Template>ConditionUnlocked</Template>
            <Values>
              <Condition />
              <ConditionUnlocked>
                <UnlockNeeded>1500005544</UnlockNeeded>
              </ConditionUnlocked>
              <ConditionPropsNegatable />
            </Values>
          </TriggerCondition>
          <SubTriggers>
            <Item>
              <SubTrigger>
                <Template>AutoCreateTrigger</Template>
                <Values>
                  <Trigger>
                    <TriggerCondition>
                      <Template>ConditionEvent</Template>
                      <Values>
                        <Condition />
                        <ConditionEvent>
                          <ConditionEvent>IslandSettled</ConditionEvent>
                          <ContextAssetInfolayer>0</ContextAssetInfolayer>
                        </ConditionEvent>
                        <ConditionPropsNegatable />
                      </Values>
                    </TriggerCondition>
                  </Trigger>
                </Values>
              </SubTrigger>
            </Item>
          </SubTriggers>
          <TriggerActions>
            <Item>
              <TriggerAction>
                <Template>ActionExecuteScript</Template>
                <Values>
                  <Action />
                  <ActionExecuteScript>
                    <ScriptFileName>data/scripts_serp/peers_islandsettled.lua</ScriptFileName>
                  </ActionExecuteScript>
                </Values>
              </TriggerAction>
            </Item>
          </TriggerActions>
          <ResetTrigger>
            <Template>AutoCreateTrigger</Template>
            <Values>
              <Trigger>
                <TriggerCondition>
                  <IsBaseAutoCreateAsset>1</IsBaseAutoCreateAsset>
                  <Values>
                    <Condition />
                    <ConditionAlwaysTrue />
                  </Values>
                </TriggerCondition>
              </Trigger>
            </Values>
          </ResetTrigger>
        </Trigger>
        <TriggerSetup>
            <AutoRegisterTrigger>1</AutoRegisterTrigger>
            <UsedBySecondParties>0</UsedBySecondParties>
          <AutoSelfUnlock>0</AutoSelfUnlock>
        </TriggerSetup>
      </Values>
    </Asset>
    
  </ModOp>
  
  <ModOp Type="add" GUID="1500004636" Path="/Values/Trigger/ResetTrigger/Values/Trigger/TriggerActions">
    <Item>
      <TriggerAction>
        <Template>ActionExecuteScript</Template>
        <Values>
          <Action />
          <ActionExecuteScript>
            <ScriptFileName>data/scripts_serp/check_peers.lua</ScriptFileName>
          </ActionExecuteScript>
        </Values>
      </TriggerAction>
    </Item>
    
  </ModOp>
    
    
    


</ModOps>